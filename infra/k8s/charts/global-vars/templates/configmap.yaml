apiVersion: v1
kind: ConfigMap
metadata:
  name: global-vars
  annotations:
    kubed.appscode.com/sync: "true"
    kubed.appscode.com/sync.pattern: ".*"
data:
  ElasticSearchConfig__ClusterUrl: {{ .Values.ElasticSearchConfig__ClusterUrl | quote }}
  ElasticSearchConfig__CaSecretName: "es-ca"
  ElasticSearchConfig__ApiKeySecretName: "es-api-key"

  OTEL_EXPORTER_OTLP_ENDPOINT: http://{{ .Values.observability.otlpService }}.{{ .Values.observability.namespace }}.svc.cluster.local:{{ .Values.observability.otlpPort }}
  OTEL_EXPORTER_OTLP_PROTOCOL: {{ .Values.observability.otlpProtocol | default "grpc" | quote }}

  ClickhouseConfig__ConnectionString: "Host={{ .Values.clickhouse.resourcePrefix }}-svc.{{ .Values.clickhouse.namespace }}.svc.cluster.local;Port={{ .Values.clickhouse.port }};Database={{ .Values.clickhouse.database }};Username={{ .Values.clickhouse.username }};Password={{ .Values.clickhouse.password | default "" }};Compress={{ .Values.clickhouse.compress }}"

  AppServiceNamespace: {{ .Values.appServiceNamespace | default "app-services" | quote }}

  SQLSERVER_PORT: "1433"
  SQLSERVER_COMMANDS_SERVICE_NAME: {{ .Values.sqlservers.commands.serviceName | quote }}
  SQLSERVER_COMMANDS_HOST: {{ printf "%s.%s.svc.cluster.local" .Values.sqlservers.commands.serviceName (.Values.appServiceNamespace | default "app-services") | quote }}
  SQLSERVER_COMMANDS_DB: {{ .Values.sqlservers.commands.database | quote }}

  SQLSERVER_FAILED_VIEW_REBUILDER_SERVICE_NAME: {{ .Values.sqlservers.failedViewRebuilder.serviceName | quote }}
  SQLSERVER_FAILED_VIEW_REBUILDER_HOST: {{ printf "%s.%s.svc.cluster.local" .Values.sqlservers.failedViewRebuilder.serviceName (.Values.appServiceNamespace | default "app-services") | quote }}
  SQLSERVER_FAILED_VIEW_REBUILDER_DB: {{ .Values.sqlservers.failedViewRebuilder.database | quote }}
  {{- if .Values.envSpecific }}
  {{- range $key, $value := .Values.envSpecific }}
  {{ $key }}: {{ $value | quote }}
  {{- end }}
  {{- end }}